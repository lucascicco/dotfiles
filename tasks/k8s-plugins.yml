---
- name: Install krew kubernetes pluging manager
  shell: >
    (
      set -x; cd "$(mktemp -d)" &&
      OS="$(uname | tr '[:upper:]' '[:lower:]')" &&
      ARCH="$(uname -m | sed -e 's/x86_64/amd64/' -e 's/\(arm\)\(64\)\?.*/\1\2/' -e 's/aarch64$/arm64/')" &&
      KREW="krew-${OS}_${ARCH}" &&
      curl -fsSLO "https://github.com/kubernetes-sigs/krew/releases/latest/download/${KREW}.tar.gz" &&
      tar zxvf "${KREW}.tar.gz" &&
      ./"${KREW}" install krew
    )
- name: Add krew bin path env to zshrc
  shell: >
    echo export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH" >> ~/.zshrc
- name: Install k8s plugings
  command: kubectl krew install {{ item }}
  with_items:
    - popeye
    - ns
    - ctx
    - score
    - example
    - sniff
    - tree
- name: Install mizu API traffic viewer for k8s
  become_user: root
  shell: >
    curl -Lo mizu github.com/up9inc/mizu/releases/latest/download/mizu_linux_amd64 && chmod 755 mizu
    mv mizu /usr/local/bin/
- name: Install octant
  become_user: root
  shell: >
    curl -s https://api.github.com/repos/octant/compose/releases/latest | grep browser_download_url  | grep octant-linux-x86_64 | cut -d '"' -f 4 | wget -qi -
    chmod 755 octant
    mv octant /usr/local/bin/
